# 控制台闭环与降级验收清单

> 文档状态：兼容保留  
> 更新时间：2026-02-24  
> 适用范围：统一控制台（发现 -> 诊断 -> 回放 -> 追溯）与 dashboard 降级场景

## 1. 目标

把值班常用路径固化为可执行清单，避免“页面可见但流程不可回放”或“降级语义不一致”：

1. 闭环路径可完整走通
2. `/api/dashboard` 降级行为可复核
3. 异常时有明确排障入口

## 2. 前置条件

1. 后端服务可访问：`http://localhost:8082`
2. 前端控制台可访问：`http://localhost:8081`
3. 至少准备一条可复现的文件上传或告警样本

## 3. 闭环路径验收（发现 -> 诊断 -> 回放 -> 追溯）

## 3.1 发现

1. 打开主控制台，确认仪表盘可加载
2. 检查队列深度、失败计数、趋势图是否有数据

验收：
- `GET /api/dashboard` 返回 `200`
- 页面可看到指标卡、上传记录、监控摘要

## 3.2 诊断

1. 在主控制台选择文件，执行 Tail/检索
2. 在告警控制台查看告警概览与决策解释字段

验收：
- `POST /api/file-log` 可返回内容或匹配结果
- `GET /api/alerts` 返回 `decisions[].explain` 字段

## 3.3 回放

1. 执行 AI 回放脚本或在配置页触发 AI 快速分析
2. 对比回放结果中的 `degraded`、`errorClass`

验收：
- `ai-replay` 可产出结果 JSON
- AI 降级与错误分类字段可解释

## 3.4 追溯

1. 在告警详情查看知识推荐与 `knowledgeTrace`
2. 在控制面查看任务事件与审计日志

验收：
- 告警推荐链路可回溯到知识条目
- 控制面任务可看到事件流与审计记录

## 4. dashboard 降级校验

## 4.1 接口口径核对

逐项验证以下接口在运行态未就绪时仍返回可读降级数据：

1. `GET /api/dashboard`
2. `GET /api/dashboard?mode=light`
3. `GET /api/health`

验收：
- 状态码为 `200`
- 返回结构可被前端消费

## 4.2 值班排障路径

若前端出现“仪表盘加载失败”，按顺序排查：

1. 直接访问 `/api/dashboard` 和 `/api/dashboard?mode=light`
2. 检查后端日志与 `config.runtime.yaml` 读写权限
3. 检查前端 `VITE_API_BASE` 或反向代理配置

## 5. 演练记录模板

| 项目 | 执行人 | 日期 | 结果(P/F) | 备注 |
| --- | --- | --- | --- | --- |
| 发现路径 |  |  |  |  |
| 诊断路径 |  |  |  |  |
| 回放路径 |  |  |  |  |
| 追溯路径 |  |  |  |  |
| dashboard 降级校验 |  |  |  |  |

## 6. 关联文档

- `docs/02-开发运维/前后端联动说明.md`
- `docs/02-开发运维/常见问题.md`
- `docs/03-告警与AI/AI回放验收手册.md`

