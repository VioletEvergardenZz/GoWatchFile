# 运维事件分析与知识决策平台概述

> 文档状态：兼容保留  
> 校准日期：2026-02-22
> 口径说明：如与主线目录冲突，以 docs/00-文档治理/文档现行状态清单.md 与主线目录文档为准。

> 目标：将多源运维事件（文件、日志、告警）收敛为可分析、可决策、可复用的平台。

## 当前实现（与代码一致）
- **输入适配器（go-watch-file）**：当前提供文件监控上传能力，可作为事件入口之一。
- **临时文件过滤**：内置忽略 `.tmp/.part/.crdownload` 等后缀。
- **上传失败重试**：可配置开关、重试间隔与最大尝试次数（含退避扩展）。
- **队列背压保护**：支持队列饱和阈值与熔断限流，避免持续堆积。
- **控制台 API**：聚合仪表盘数据，提供自动上传开关、手动上传、文件 Tail/检索 与运行时配置更新。
- **AI 日志分析**：可对选中文件进行 AI 总结（需配置 AI_* 并启用）。
- **AI 降级策略**：超时/网络异常时自动压缩重试，失败后降级为规则摘要并返回错误分类。
- **告警决策模块**：轮询日志文件，规则匹配与抑制/升级决策，提供告警面板与配置接口。
- **Prometheus 指标**：新增 `/metrics`，覆盖上传、队列、AI 与知识库关键指标。
- **前端控制台**：展示目录树、文件列表、上传记录、队列趋势、监控摘要与 Tail。
- **系统资源面板**：提供 CPU/内存/磁盘/进程概览接口，供资源管理控制台使用（默认关闭，可在控制台启用）。
- **通知**：钉钉机器人通知 / 邮件通知（可选）。

## 当前阶段定位（已对齐）
- **主线已调整**：当前主线是“告警决策 + AI 分析 + 知识复用”，文件上传不再是唯一主题。
- **文件监控上传定位**：作为可选输入适配器持续维护，按实际使用量投入资源。
- **定位可演进**：后续如有新需求，可重新调整输入侧重点，但保留统一观测与决策闭环。

## 典型工作流（文件采集路径示例）
1) 文件写入到监控目录（支持子目录）。
2) Agent 判断后缀并等待静默窗口结束。
3) 进入上传队列 → worker 并发上传至 OSS。
4) 运行态记录上传结果，并通过 API 提供给控制台。
5) （可选）钉钉通知发送上传结果，邮件同步通知。
6) （可选）告警模块轮询日志并生成告警决策，控制台展示风险概览。

## 现状与限制
- **多监控目录**：`watch_dir` 支持逗号或分号分隔，`file_ext` 为空时视为不过滤，支持多后缀配置。
- **队列在内存中**：重启后清空；无断点续传。
- **通知渠道有限**：当前钉钉通知 + 邮件通知，企业微信仅保留字段。
- **无多 Agent 管理**：控制面为本地 API + 前端。
- **系统资源面板默认关闭**：需要在控制台配置开启后才能访问 `/api/system`。

## 规划方向（概览）
- 可靠性与观测：完善重试策略（退避/上限）、断点续传/ETag 校验、指标暴露（Prometheus）。
- 控制面建设：多 Agent 管理、配置中心、统一访问策略与审计。
- 平台化编排：路由/编排、Webhook/队列触发、报表与高级告警体系。
- AIOps 增强：异常检测、根因关联、策略推荐与可回滚自动化。

详细规划见 `todo.md` 与 `大纲.md`。
近期执行计划见 `docs/01-总览规划/下一阶段执行计划.md`。
文档分组导航见 `docs/文档导航.md`。

## 进一步阅读
- 阶段评估：`docs/01-总览规划/技术负责人评估.md`
- 下一阶段计划：`docs/01-总览规划/下一阶段执行计划.md`
- 指标字典：`docs/05-指标与评估/监控指标字典-v1.md`
- 告警阈值草案：`docs/05-指标与评估/指标告警阈值草案-v0.1.md`
- 上传可靠性演练手册：`docs/03-告警与AI/上传可靠性演练手册.md`
- AI 回放手册：`docs/03-告警与AI/AI回放验收手册.md`
- 阶段回归报告模板：`docs/05-指标与评估/阶段回归报告模板-v1.md`
- 流程图：`docs/99-架构附录/系统流程图.md`
- 开发指南：`docs/02-开发运维/开发指南.md`
- 前后端联动：`docs/02-开发运维/前后端联动说明.md`
- DTO 结构：`docs/99-架构附录/状态类型可视化.md`
- 告警模式：`docs/03-告警与AI/告警模式说明.md`
- 告警控制台：`docs/03-告警与AI/告警控制台说明.md`
- FAQ：`docs/02-开发运维/常见问题.md`
