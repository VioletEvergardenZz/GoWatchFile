# 通用文件监控与 AIOps 运维平台概述

> 目标：将“文件监控 + 上传 + 告警 + AI 分析 + 可视化”抽象为通用平台，支持业务文件自动入云、风险识别与运维决策闭环。

## 当前实现（与代码一致）
- **Agent（go-watch-file）**：递归监控目录，静默窗口判定写入完成，上传至阿里云 OSS。
- **临时文件过滤**：内置忽略 `.tmp/.part/.crdownload` 等后缀。
- **上传失败重试**：可配置开关与重试间隔。
- **控制台 API**：聚合仪表盘数据，提供自动上传开关、手动上传、文件 Tail/检索 与运行时配置更新。
- **AI 日志分析**：可对选中文件进行 AI 总结（需配置 AI_* 并启用）。
- **告警决策模块**：轮询日志文件，规则匹配与抑制/升级决策，提供告警面板与配置接口。
- **前端控制台**：展示目录树、文件列表、上传记录、队列趋势、监控摘要与 Tail。
- **系统资源面板**：提供 CPU/内存/磁盘/进程概览接口，供资源管理控制台使用（默认关闭，可在控制台启用）。
- **通知**：钉钉机器人通知 / 邮件通知（可选）。

## 当前阶段定位（已对齐）
- **主线不是单一上传工具**：当前已具备上传、告警、AI 分析三条可运行链路，应按平台化思路治理与迭代。
- **AI 为必要能力**：AI 日志总结与告警分析属于核心能力，现阶段以“可配置开关 + 人工确认”方式落地，而非排除在范围外。
- **执行策略**：短期稳住可靠性与观测，中期补齐控制面与多 Agent，长期走向路由编排与 AIOps 自动化。

## 典型工作流
1) 文件写入到监控目录（支持子目录）。
2) Agent 判断后缀并等待静默窗口结束。
3) 进入上传队列 → worker 并发上传至 OSS。
4) 运行态记录上传结果，并通过 API 提供给控制台。
5) （可选）钉钉通知发送上传结果，邮件同步通知。
6) （可选）告警模块轮询日志并生成告警决策，控制台展示风险概览。

## 现状与限制
- **多监控目录**：`watch_dir` 支持逗号或分号分隔，`file_ext` 为空时视为不过滤，支持多后缀配置。
- **队列在内存中**：重启后清空；无断点续传。
- **通知渠道有限**：当前钉钉通知 + 邮件通知，企业微信仅保留字段。
- **无多 Agent 管理**：控制面为本地 API + 前端。
- **系统资源面板默认关闭**：需要在控制台配置开启后才能访问 `/api/system`。

## 规划方向（概览）
- 可靠性与观测：完善重试策略（退避/上限）、断点续传/ETag 校验、指标暴露（Prometheus）。
- 控制面建设：多 Agent 管理、配置中心、统一鉴权与审计。
- 平台化编排：路由/编排、Webhook/队列触发、报表与高级告警体系。
- AIOps 增强：异常检测、根因关联、策略推荐与可回滚自动化。

详细规划见 `todo.md` 与 `大纲.md`。

## 进一步阅读
- 阶段评估：`docs/tech-lead-assessment.md`
- 流程图：`docs/system-flowchart.md`
- 开发指南：`docs/dev-guide.md`
- 前后端联动：`docs/frontend-backend-linkage.md`
- DTO 结构：`docs/state-types-visual.md`
- 告警模式：`docs/alert-mode.md`
- 告警控制台：`docs/alert-console.md`
- FAQ：`docs/faq.md`
