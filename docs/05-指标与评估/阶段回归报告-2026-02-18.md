# 阶段回归报告（2026-02-18）

- 报告日期：2026-02-18
- 执行人：Codex
- 环境：`dev-like (local)-go-run`
- 版本：`17c1a40`
- 复盘结果文件：`..\reports\stage-recap-full-2026-02-18.json`
- 指标快照：`D:\work\go\GWF\reports\metrics-stage.prom`

## 1. 目标与范围

- 本轮目标：完成阶段脚本回放并自动生成可归档报告
- 覆盖链路：
  - 上传链路
  - AI 日志分析
  - 知识库检索与问答
  - 告警推荐
  - 控制面任务分发与回放

## 2. 执行清单

| 项目 | 命令/入口 | 结果（P/F） | 备注 |
| --- | --- | --- | --- |
| 后端测试 | cd go-watch-file && go test ./... | - | 可选接入 stage-recap 扩展阶段 |
| 前端构建 | cd console-frontend && npm run build | - | 可选接入 stage-recap 扩展阶段 |
| 指标巡检 | check-metrics.ps1 | P | exitCode=0, elapsedMs=1079 |
| 上传压测 | upload-stress.ps1 | - | 建议单独执行并写入备注 |
| AI 回放 | ai-replay.ps1 | P | total=3, success=0, degraded=3, ratio=100% |
| 控制面回放 | control-replay.ps1 | P | done=30/30, success=30, failed=0 |
| 控制面审计查询 | GET /api/control/audit | - | 建议通过控制台筛选或接口抽样验证 |
| 检索命中率 | kb-eval hitrate | P | hitrate=0.00% |
| 问答引用率 | kb-eval citation | F | citation=0.00% |
| MTTD 对比 | kb-eval mttd | P | drop=31.75% |

## 3. 关键指标结果

| 指标 | 目标 | 本次结果 | 是否达标 |
| --- | --- | --- | --- |
| gwf_upload_queue_full_total 增量 | 越低越好 | 0 | P |
| 上传失败率（10m） | < 5% | N/A | - |
| AI 降级率 | <= 20% | 100.00% | F |
| 知识检索命中率 | >= 80% | 0.00% | F |
| 问答引用率 | = 100% | 0.00% | F |
| 控制面在线 Agent 数 | >= 1 | 0 | F |
| 控制面 backlog | <= 50（参考阈值） | 0 | P |
| 控制面任务超时增量（10m） | = 0 | 0 | P |

补充：
- AI 总请求：3，成功：0，降级：3
- MTTD 下降比例：31.75%

## 4. 失败样例与根因

| 场景 | 现象 | 根因 | 修复动作 | Owner | 截止日期 |
| --- | --- | --- | --- | --- | --- |
| kb-recap | 阶段执行失败 | exitCode=3，执行 hitrate: go run ./cmd/kb-eval hitrate -base http://127.0.0.1:8080 -token codex-stage-token -samples ../docs/04-知识库/知识库命中率样本.json -limit 5 | 检查依赖服务、鉴权 Token 与脚本参数后重跑 | 平台 | 待定 |

## 5. 风险与待办

1. 风险：阶段失败项未闭环（kb-recap）
2. 待办：按失败阶段输出定位环境/配置问题并重跑 stage-recap.ps1
3. 待办：重跑成功后使用 stage-report.ps1 重新生成报告并归档

## 6. 结论

- 是否允许进入下一阶段：`否`
- 结论摘要：仍有阶段门禁未通过，需先完成失败项闭环

