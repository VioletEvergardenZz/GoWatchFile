# 本文件用于后端静态配置与默认值
# 运行中可由控制台覆盖的字段会写入 config.runtime.yaml
# 标注为“静态配置”的字段不在 /api/config 热更新范围，修改后需重启后端进程

# 文件监控配置
# 监控目录：留空则由控制台设置；手工填写建议使用绝对路径以避免工作目录变化
# 支持多个目录，逗号或分号分隔
watch_dir: ""
# 排除目录：目录名或绝对路径，逗号或分号分隔
# 建议排除日志归档/临时目录，避免重复触发上传和告警
watch_exclude: ""
# 文件后缀过滤：逗号或空格分隔，留空表示不过滤
# 在高吞吐场景下建议显式设置后缀，减少无关文件进入处理链路
file_ext: ""
# 写入完成判定窗口：用于规避“大文件尚未写完就被读取”的边界问题
# 为空则使用默认值
silence: "10s"

# 通知配置 可选
# 机器人预留字段 当前未使用
robot_key: "${ROBOT_KEY}"
# 钉钉机器人
dingtalk_webhook: "${DINGTALK_WEBHOOK}"
dingtalk_secret: "${DINGTALK_SECRET}"

# 邮件通知 可选
email_host: "smtp.qq.com"
email_user: "${EMAIL_USER}"
email_pass: "${EMAIL_PASS}"
email_from: "${EMAIL_FROM}"
email_to: "${EMAIL_TO}"
email_port: 587
email_use_tls: true

# OSS 存储配置
bucket: "go-watch-file"
ak: "${OSS_AK}"
sk: "${OSS_SK}"
endpoint: "oss-cn-hangzhou.aliyuncs.com"
region: "cn-hangzhou"
force_path_style: false
disable_ssl: false

# 日志配置
log_level: "info"
log_file: "logs/file-monitor.log"
log_to_std: true
log_show_caller: false

# 上传并发配置
# upload_workers / upload_queue_size 共同决定吞吐上限与内存占用，建议结合压测结果调优
upload_workers: 10
upload_queue_size: 100
# 上传队列持久化（静态配置，需重启生效）
# 持久化用于进程重启恢复未消费任务；文件损坏会按降级策略回退为空队列继续运行
upload_queue_persist_enabled: false
upload_queue_persist_file: "logs/upload-queue.json"
# 上传队列饱和保护（静态配置，需重启生效）
# threshold 建议保持在 0~1，接近 1 时优先保吞吐，接近 0 时优先保稳定性
upload_queue_saturation_threshold: 0.9
# 开启后在队列饱和时触发熔断限流，避免持续积压导致系统雪崩
upload_queue_circuit_breaker_enabled: true
# 上传重试策略（静态配置，需重启生效）
# 最大尝试次数包含首次上传；重试越多成功率越高，但会拉长尾延迟
upload_retry_max_attempts: 4
# 上传完成后校验 OSS 返回的 ETag（静态配置，需重启生效）
# 开启后会对比本地内容 MD5 与 ETag，一致才视为成功
upload_etag_verify_enabled: false
# 断点续传（静态配置，需重启生效）
# 开启后当文件大小达到阈值会走 multipart + checkpoint 上传
upload_resumable_enabled: false
upload_resumable_part_size: 10485760
upload_resumable_routines: 1
upload_resumable_threshold: 10485760
upload_resumable_checkpoint_dir: "logs/upload-checkpoints"

# API 服务配置
# API 监听地址 控制台通过此地址访问接口
api_bind: ":8080"
# 管理接口鉴权令牌（建议从环境变量读取）
# 为空或占位符时将关闭 API 鉴权；如需显式关闭可设置 API_AUTH_DISABLED=true
api_auth_token: "${API_AUTH_TOKEN}"
# 允许跨域来源列表（逗号分隔）可填写 * 表示放开
api_cors_origins: "${API_CORS_ORIGINS}"
# 系统资源面板开关 默认关闭
system_resource_enabled: false

# 告警配置（建议通过控制台设置）
# 规则内容存于 config.runtime.yaml 的 alert_rules
# 启用告警时必须配置日志路径并保存规则
alert_enabled: false
# 为 true 时按 suppression 策略去重降噪；为 false 时所有命中均可发送
alert_suppress_enabled: true
# 告警规则文件路径（兼容字段，当前不再使用）
alert_rules_file: ""
# 需要监控的日志路径 逗号或分号分隔
alert_log_paths: ""
# 告警轮询间隔 支持 2s 2秒 2
alert_poll_interval: "2s"
# true 表示从文件末尾开始，仅处理新内容，避免启用后一次性回放历史日志导致告警风暴
alert_start_from_end: true

# AI 分析配置（默认关闭）
ai_enabled: false
ai_base_url: "${AI_BASE_URL}"
ai_api_key: "${AI_API_KEY}"
ai_model: "${AI_MODEL}"
# AI 调用总超时（含重试）；超时后会按降级策略返回规则摘要
ai_timeout: "90s"
# 单次参与分析的最大行数，用于限制 token 成本与响应时延
ai_max_lines: 200
